<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruitment EDM Performance Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f7fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            color: #1a202c;
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #718096;
            margin-bottom: 24px;
        }
        
        .filters {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #4a5568;
        }
        
        select, button {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        button {
            background-color: #4299e1;
            color: white;
            border: none;
            font-weight: 600;
        }
        
        button:hover {
            background-color: #3182ce;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-container {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 16px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #718096;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
        }
        
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(13, 1fr);
            gap: 4px;
            margin-top: 20px;
        }
        
        .heatmap-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 8px;
            text-align: center;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .heatmap-header {
            font-weight: 700;
            color: #2d3748;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }
        
        .heatmap-label {
            font-weight: 700;
            color: #2d3748;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 0.85rem;
        }
        
        .heatmap-legend {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 6px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 3px;
        }
        
        .heatmap-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .heatmap-stat-card {
            background: #f7fafc;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .heatmap-stat-label {
            font-size: 0.875rem;
            color: #718096;
            margin-bottom: 5px;
        }
        
        .heatmap-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Recruitment EDM Performance Dashboard</h1>
        <p class="subtitle">Track engagement trends across Leadership and TPW programs (2020-2025)</p>
        
        <div class="filters">
            <div class="filter-group">
                <label>Program Type</label>
                <select id="programFilter">
                    <option value="all">All Programs</option>
                    <option value="leadership">Leadership (Federal + State)</option>
                    <option value="tpw">TPW</option>
                    <option value="federal">Federal Leadership</option>
                    <option value="state">State Leadership</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Campaign Type</label>
                <select id="campaignFilter">
                    <option value="all">All Types</option>
                    <option value="Launch">Launch</option>
                    <option value="Sweep">Sweep</option>
                    <option value="Final call">Final Call</option>
                    <option value="Announce">Announce</option>
                </select>
            </div>
            
            <button onclick="updateCharts()">Apply Filters</button>
            <button onclick="resetFilters()" style="background-color: #718096;">Reset</button>
        </div>
        
        <div class="stats-grid" id="statsGrid"></div>
        
        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">Leadership Programs - Open Rate & Click Rate Trends</div>
                <div class="chart-wrapper">
                    <canvas id="leadershipChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">TPW Course - Open Rate & Click Rate Trends</div>
                <div class="chart-wrapper">
                    <canvas id="tpwChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Performance by Campaign Type</div>
                <div class="chart-wrapper">
                    <canvas id="campaignTypeChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Leadership vs TPW Performance Comparison</div>
                <div class="chart-wrapper">
                    <canvas id="programComparisonChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Year-over-Year Performance - Leadership & TPW</div>
                <div class="chart-wrapper">
                    <canvas id="yearOverYearChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Monthly Engagement Heatmap - Best Times to Send Campaigns</div>
                <div id="heatmapContainer" style="padding: 20px;"></div>
            </div>
        </div>
    </div>

    <script>
        const fullData = [
            {date:"30/01/2020",category:"Federal Leadership",type:"Announce",open:71.1,click:11.1,email:"Federal PLP Announce"},
            {date:"30/01/2020",category:"State Leadership",type:"Announce",open:51.3,click:19.3,email:"State PLP Announce"},
            {date:"06/03/2020",category:"Practical",type:"Intro",open:25.1,click:8.5,email:"Practical Intro ALL"},
            {date:"27/05/2020",category:"Practical",type:"Intro",open:21.4,click:11.1,email:"Practical Intro NSW - no opens"},
            {date:"22/06/2020",category:"Practical",type:"Intro",open:37.3,click:6,email:"Practical Intro NSW"},
            {date:"08/03/2023",category:"State Leadership",type:"Final call",open:68,click:53.8,email:"State Final Call"},
            {date:"20/04/2023",category:"Federal Leadership",type:"Launch",open:29.7,click:4.1,email:"Federal Launch Incumbents"},
            {date:"20/06/2023",category:"Federal Leadership",type:"Sweep",open:33.3,click:3.4,email:"Federal Sweep Up"},
            {date:"28/06/2023",category:"TPW",type:"Launch",open:39.5,click:18.6,email:"TPW Launch"},
            {date:"28/06/2023",category:"TPW",type:"Launch",open:39.5,click:47.1,email:"TPW Launch 23"},
            {date:"06/07/2023",category:"State Leadership",type:"Launch",open:47.9,click:19.1,email:"State Launch"},
            {date:"13/07/2023",category:"State Leadership",type:"Sweep",open:44,click:17,email:"State Sweep Up"},
            {date:"27/07/2023",category:"TPW",type:"Sweep",open:42.1,click:18.4,email:"TPW Sweep Up"},
            {date:"03/08/2023",category:"Federal Leadership",type:"Final call",open:25.3,click:1.1,email:"Federal Last Call"},
            {date:"03/08/2023",category:"State Leadership",type:"Final call",open:68.2,click:78.9,email:"State Leadership Final Call 23"},
            {date:"03/08/2023",category:"Federal Leadership",type:"Final call",open:25.3,click:4.5,email:"Federal Last Call 23"},
            {date:"22/08/2023",category:"TPW",type:"Final call",open:28.1,click:3.1,email:"TPW Final Call"},
            {date:"22/08/2023",category:"TPW",type:"Final call",open:28.1,click:11.1,email:"TPW Final Call"},
            {date:"18/10/2023",category:"TPW",type:"Announce",open:38.3,click:5.6,email:"TPW Dec Dates Launch"},
            {date:"15/02/2024",category:"TPW",type:"Launch",open:10.1,click:28.6,email:"NSW TPW Launch 2024"},
            {date:"21/03/2024",category:"Federal Leadership",type:"Sweep",open:87,click:1.5,email:"Leadership Sweep Up Election year"},
            {date:"16/05/2024",category:"Federal Leadership",type:"Sweep",open:65.1,click:0.78,email:"Leadership Sweep Up Election"},
            {date:"16/05/2024",category:"TPW",type:"Sweep",open:13.4,click:10.4,email:"TPW NSW Sweep Up 24"},
            {date:"24/07/2024",category:"Federal Leadership",type:"Sweep",open:70.9,click:3.9,email:"Leadership Sweep Up Non Election 24"},
            {date:"01/08/2024",category:"TPW",type:"Launch",open:68.2,click:4.2,email:"TPW National Launch"},
            {date:"10/10/2024",category:"TPW",type:"Sweep",open:79.9,click:51,email:"TPW National Sweep Up"},
            {date:"11/02/2025",category:"Federal Leadership",type:"Launch",open:22.1,click:4.4,email:"Leadership Launch 2025"},
            {date:"25/05/2025",category:"Federal Leadership",type:"Sweep",open:55.2,click:6.8,email:"Leadership Recruitment Email June 2025"},
            {date:"25/08/2025",category:"TPW",type:"Launch",open:72.9,click:41.7,email:"TPW WA Invitation"}
        ];

        let leadershipChart, tpwChart, campaignTypeChart, programComparisonChart, yearOverYearChart;
        let filteredData = [...fullData];

        function filterData() {
            const programFilter = document.getElementById('programFilter').value;
            const campaignFilter = document.getElementById('campaignFilter').value;
            
            filteredData = fullData.filter(item => {
                let programMatch = true;
                let campaignMatch = true;
                
                if (programFilter === 'leadership') {
                    programMatch = item.category === 'Federal Leadership' || item.category === 'State Leadership';
                } else if (programFilter === 'tpw') {
                    programMatch = item.category === 'TPW';
                } else if (programFilter === 'federal') {
                    programMatch = item.category === 'Federal Leadership';
                } else if (programFilter === 'state') {
                    programMatch = item.category === 'State Leadership';
                }
                
                if (campaignFilter !== 'all') {
                    campaignMatch = item.type === campaignFilter;
                }
                
                return programMatch && campaignMatch;
            });
        }

        function calculateStats() {
            if (filteredData.length === 0) {
                document.getElementById('statsGrid').innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #718096;">No data matches the selected filters</p>';
                return;
            }

            const avgOpen = (filteredData.reduce((sum, item) => sum + item.open, 0) / filteredData.length).toFixed(1);
            const avgClick = (filteredData.reduce((sum, item) => sum + item.click, 0) / filteredData.length).toFixed(1);
            const totalCampaigns = filteredData.length;
            
            const leadershipData = filteredData.filter(item => item.category.includes('Leadership'));
            const tpwData = filteredData.filter(item => item.category.includes('TPW'));
            
            const leadershipAvgOpen = leadershipData.length > 0 ? 
                (leadershipData.reduce((sum, item) => sum + item.open, 0) / leadershipData.length).toFixed(1) : 0;
            const leadershipAvgClick = leadershipData.length > 0 ? 
                (leadershipData.reduce((sum, item) => sum + item.click, 0) / leadershipData.length).toFixed(1) : 0;
            const tpwAvgOpen = tpwData.length > 0 ? 
                (tpwData.reduce((sum, item) => sum + item.open, 0) / tpwData.length).toFixed(1) : 0;
            const tpwAvgClick = tpwData.length > 0 ? 
                (tpwData.reduce((sum, item) => sum + item.click, 0) / tpwData.length).toFixed(1) : 0;

            // Calculate trend changes
            let leadershipOpenTrend = '';
            let leadershipClickTrend = '';
            let tpwOpenTrend = '';
            let tpwClickTrend = '';
            
            if (leadershipData.length > 1) {
                const firstL = leadershipData[0];
                const lastL = leadershipData[leadershipData.length - 1];
                const openChange = ((lastL.open - firstL.open) / firstL.open * 100);
                const clickChange = ((lastL.click - firstL.click) / firstL.click * 100);
                
                const openSymbol = openChange > 0 ? '↑' : '↓';
                const clickSymbol = clickChange > 0 ? '↑' : '↓';
                const openColor = openChange > 0 ? '#48bb78' : '#f56565';
                const clickColor = clickChange > 0 ? '#48bb78' : '#f56565';
                
                leadershipOpenTrend = `<div class="stat-change" style="color: ${openColor}">${openSymbol} ${Math.abs(openChange).toFixed(1)}% over period</div>`;
                leadershipClickTrend = `<div class="stat-change" style="color: ${clickColor}">${clickSymbol} ${Math.abs(clickChange).toFixed(1)}% over period</div>`;
            }
            
            if (tpwData.length > 1) {
                const firstT = tpwData[0];
                const lastT = tpwData[tpwData.length - 1];
                const openChange = ((lastT.open - firstT.open) / firstT.open * 100);
                const clickChange = ((lastT.click - firstT.click) / firstT.click * 100);
                
                const openSymbol = openChange > 0 ? '↑' : '↓';
                const clickSymbol = clickChange > 0 ? '↑' : '↓';
                const openColor = openChange > 0 ? '#48bb78' : '#f56565';
                const clickColor = clickChange > 0 ? '#48bb78' : '#f56565';
                
                tpwOpenTrend = `<div class="stat-change" style="color: ${openColor}">${openSymbol} ${Math.abs(openChange).toFixed(1)}% over period</div>`;
                tpwClickTrend = `<div class="stat-change" style="color: ${clickColor}">${clickSymbol} ${Math.abs(clickChange).toFixed(1)}% over period</div>`;
            }

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Average Open Rate</div>
                    <div class="stat-value">${avgOpen}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Click Rate</div>
                    <div class="stat-value">${avgClick}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Campaigns</div>
                    <div class="stat-value">${totalCampaigns}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Leadership Avg Open</div>
                    <div class="stat-value">${leadershipAvgOpen}%</div>
                    ${leadershipOpenTrend}
                </div>
                <div class="stat-card">
                    <div class="stat-label">Leadership Avg Click</div>
                    <div class="stat-value">${leadershipAvgClick}%</div>
                    ${leadershipClickTrend}
                </div>
                <div class="stat-card">
                    <div class="stat-label">TPW Avg Open</div>
                    <div class="stat-value">${tpwAvgOpen}%</div>
                    ${tpwOpenTrend}
                </div>
                <div class="stat-card">
                    <div class="stat-label">TPW Avg Click</div>
                    <div class="stat-value">${tpwAvgClick}%</div>
                    ${tpwClickTrend}
                </div>
            `;
        }

        function createLeadershipChart() {
            const ctx = document.getElementById('leadershipChart').getContext('2d');
            
            if (leadershipChart) leadershipChart.destroy();
            
            const leadershipData = filteredData.filter(item => item.category.includes('Leadership'));
            
            if (leadershipData.length === 0) return;
            
            leadershipChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: leadershipData.map(item => item.date),
                    datasets: [
                        {
                            label: 'Open Rate %',
                            data: leadershipData.map(item => item.open),
                            borderColor: '#4299e1',
                            backgroundColor: 'rgba(66, 153, 225, 0.1)',
                            borderWidth: 3,
                            tension: 0.1,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            fill: true,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Click Rate %',
                            data: leadershipData.map(item => item.click),
                            borderColor: '#3182ce',
                            backgroundColor: 'rgba(49, 130, 206, 0.1)',
                            borderWidth: 3,
                            tension: 0.1,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 15,
                                font: { size: 12 },
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const index = context[0].dataIndex;
                                    return leadershipData[index].email;
                                },
                                afterTitle: function(context) {
                                    const index = context[0].dataIndex;
                                    return `${leadershipData[index].date} | ${leadershipData[index].type} | ${leadershipData[index].category}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Percentage (%)',
                                font: { size: 13 }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                font: { size: 10 }
                            }
                        }
                    }
                }
            });
        }

        function createTPWChart() {
            const ctx = document.getElementById('tpwChart').getContext('2d');
            
            if (tpwChart) tpwChart.destroy();
            
            const tpwData = filteredData.filter(item => item.category.includes('TPW'));
            
            if (tpwData.length === 0) return;
            
            tpwChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: tpwData.map(item => item.date),
                    datasets: [
                        {
                            label: 'Open Rate %',
                            data: tpwData.map(item => item.open),
                            borderColor: '#48bb78',
                            backgroundColor: 'rgba(72, 187, 120, 0.1)',
                            borderWidth: 3,
                            tension: 0.1,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            fill: true,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Click Rate %',
                            data: tpwData.map(item => item.click),
                            borderColor: '#38a169',
                            backgroundColor: 'rgba(56, 161, 105, 0.1)',
                            borderWidth: 3,
                            tension: 0.1,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 15,
                                font: { size: 12 },
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const index = context[0].dataIndex;
                                    return tpwData[index].email;
                                },
                                afterTitle: function(context) {
                                    const index = context[0].dataIndex;
                                    return `${tpwData[index].date} | ${tpwData[index].type}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Percentage (%)',
                                font: { size: 13 }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                font: { size: 10 }
                            }
                        }
                    }
                }
            });
        }

        function createCampaignTypeChart() {
            const ctx = document.getElementById('campaignTypeChart').getContext('2d');
            
            if (campaignTypeChart) campaignTypeChart.destroy();
            
            const launchItems = filteredData.filter(item => 
                item.type === 'Launch' || item.type === 'Announce' || item.type === 'Intro'
            );
            const sweepItems = filteredData.filter(item => item.type === 'Sweep');
            const finalCallItems = filteredData.filter(item => item.type === 'Final call');
            
            const typeStats = [];
            
            if (launchItems.length > 0) {
                typeStats.push({
                    type: 'Launch/Announce',
                    avgOpen: launchItems.reduce((sum, item) => sum + item.open, 0) / launchItems.length,
                    avgClick: launchItems.reduce((sum, item) => sum + item.click, 0) / launchItems.length,
                    count: launchItems.length
                });
            }
            
            if (sweepItems.length > 0) {
                typeStats.push({
                    type: 'Sweep',
                    avgOpen: sweepItems.reduce((sum, item) => sum + item.open, 0) / sweepItems.length,
                    avgClick: sweepItems.reduce((sum, item) => sum + item.click, 0) / sweepItems.length,
                    count: sweepItems.length
                });
            }
            
            if (finalCallItems.length > 0) {
                typeStats.push({
                    type: 'Final call',
                    avgOpen: finalCallItems.reduce((sum, item) => sum + item.open, 0) / finalCallItems.length,
                    avgClick: finalCallItems.reduce((sum, item) => sum + item.click, 0) / finalCallItems.length,
                    count: finalCallItems.length
                });
            }
            
            campaignTypeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: typeStats.map(item => `${item.type} (${item.count})`),
                    datasets: [
                        {
                            label: 'Avg Open Rate %',
                            data: typeStats.map(item => item.avgOpen),
                            backgroundColor: 'rgba(66, 153, 225, 0.7)',
                            borderColor: '#4299e1',
                            borderWidth: 2
                        },
                        {
                            label: 'Avg Click Rate %',
                            data: typeStats.map(item => item.avgClick),
                            backgroundColor: 'rgba(72, 187, 120, 0.7)',
                            borderColor: '#48bb78',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Percentage (%)'
                            }
                        }
                    }
                }
            });
        }

        function createProgramComparisonChart() {
            const ctx = document.getElementById('programComparisonChart').getContext('2d');
            
            if (programComparisonChart) programComparisonChart.destroy();
            
            const leadershipData = filteredData.filter(item => item.category.includes('Leadership'));
            const tpwData = filteredData.filter(item => item.category.includes('TPW'));
            
            const stats = [
                {
                    label: 'Leadership',
                    avgOpen: leadershipData.length > 0 ? leadershipData.reduce((sum, item) => sum + item.open, 0) / leadershipData.length : 0,
                    avgClick: leadershipData.length > 0 ? leadershipData.reduce((sum, item) => sum + item.click, 0) / leadershipData.length : 0,
                    count: leadershipData.length
                },
                {
                    label: 'TPW',
                    avgOpen: tpwData.length > 0 ? tpwData.reduce((sum, item) => sum + item.open, 0) / tpwData.length : 0,
                    avgClick: tpwData.length > 0 ? tpwData.reduce((sum, item) => sum + item.click, 0) / tpwData.length : 0,
                    count: tpwData.length
                }
            ];
            
            programComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: stats.map(item => `${item.label} (${item.count} campaigns)`),
                    datasets: [
                        {
                            label: 'Avg Open Rate %',
                            data: stats.map(item => item.avgOpen),
                            backgroundColor: 'rgba(66, 153, 225, 0.7)',
                            borderColor: '#4299e1',
                            borderWidth: 2
                        },
                        {
                            label: 'Avg Click Rate %',
                            data: stats.map(item => item.avgClick),
                            backgroundColor: 'rgba(72, 187, 120, 0.7)',
                            borderColor: '#48bb78',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Percentage (%)'
                            }
                        }
                    }
                }
            });
        }
        
        function createFederalStateChart() {
            const ctx = document.getElementById('yearOverYearChart').getContext('2d');
            
            if (yearOverYearChart) yearOverYearChart.destroy();
            
            // Extract year from date (format: DD/MM/YYYY)
            function getYear(dateStr) {
                const parts = dateStr.split('/');
                if (parts.length === 3) {
                    let year = parseInt(parts[2]);
                    if (year < 100) year += 2000;
                    return year;
                }
                return null;
            }
            
            // Group data by year and program type
            const yearlyData = {};
            
            filteredData.forEach(item => {
                const year = getYear(item.date);
                if (!year) return;
                
                if (!yearlyData[year]) {
                    yearlyData[year] = {
                        leadership: { campaigns: [], open: [], click: [] },
                        tpw: { campaigns: [], open: [], click: [] }
                    };
                }
                
                if (item.category.includes('Leadership')) {
                    yearlyData[year].leadership.campaigns.push(item);
                    yearlyData[year].leadership.open.push(item.open);
                    yearlyData[year].leadership.click.push(item.click);
                } else if (item.category.includes('TPW')) {
                    yearlyData[year].tpw.campaigns.push(item);
                    yearlyData[year].tpw.open.push(item.open);
                    yearlyData[year].tpw.click.push(item.click);
                }
            });
            
            // Calculate averages for each year
            const years = Object.keys(yearlyData).sort();
            const leadershipOpenAvgs = [];
            const leadershipClickAvgs = [];
            const tpwOpenAvgs = [];
            const tpwClickAvgs = [];
            const leadershipCounts = [];
            const tpwCounts = [];
            
            years.forEach(year => {
                const leadOpen = yearlyData[year].leadership.open;
                const leadClick = yearlyData[year].leadership.click;
                const tpwOpen = yearlyData[year].tpw.open;
                const tpwClick = yearlyData[year].tpw.click;
                
                leadershipOpenAvgs.push(leadOpen.length > 0 ? leadOpen.reduce((a, b) => a + b, 0) / leadOpen.length : null);
                leadershipClickAvgs.push(leadClick.length > 0 ? leadClick.reduce((a, b) => a + b, 0) / leadClick.length : null);
                tpwOpenAvgs.push(tpwOpen.length > 0 ? tpwOpen.reduce((a, b) => a + b, 0) / tpwOpen.length : null);
                tpwClickAvgs.push(tpwClick.length > 0 ? tpwClick.reduce((a, b) => a + b, 0) / tpwClick.length : null);
                
                leadershipCounts.push(leadOpen.length);
                tpwCounts.push(tpwOpen.length);
            });
            
            yearOverYearChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Leadership - Open Rate %',
                            data: leadershipOpenAvgs,
                            borderColor: '#4299e1',
                            backgroundColor: 'rgba(66, 153, 225, 0.1)',
                            borderWidth: 3,
                            tension: 0.1,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Leadership - Click Rate %',
                            data: leadershipClickAvgs,
                            borderColor: '#3182ce',
                            backgroundColor: 'rgba(49, 130, 206, 0.1)',
                            borderWidth: 3,
                            tension: 0.1,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        },
                        {
                            label: 'TPW - Open Rate %',
                            data: tpwOpenAvgs,
                            borderColor: '#48bb78',
                            backgroundColor: 'rgba(72, 187, 120, 0.1)',
                            borderWidth: 3,
                            tension: 0.1,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'TPW - Click Rate %',
                            data: tpwClickAvgs,
                            borderColor: '#38a169',
                            backgroundColor: 'rgba(56, 161, 105, 0.1)',
                            borderWidth: 3,
                            tension: 0.1,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 12 },
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const yearIndex = context.dataIndex;
                                    const isLeadership = context.dataset.label.includes('Leadership');
                                    const count = isLeadership ? leadershipCounts[yearIndex] : tpwCounts[yearIndex];
                                    return `${count} campaigns`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Year',
                                font: { size: 13 }
                            },
                            ticks: {
                                font: { size: 11 }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Percentage (%)',
                                font: { size: 13 }
                            },
                            ticks: {
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }
        
        function createMonthlyHeatmap() {
            const container = document.getElementById('heatmapContainer');
            
            if (filteredData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #718096;">No data available for heatmap</p>';
                return;
            }
            
            // Extract month and year from date
            function getMonth(dateStr) {
                const parts = dateStr.split('/');
                if (parts.length === 3) {
                    return parseInt(parts[1]) - 1;
                }
                return null;
            }
            
            function getYear(dateStr) {
                const parts = dateStr.split('/');
                if (parts.length === 3) {
                    let year = parseInt(parts[2]);
                    if (year < 100) year += 2000;
                    return year;
                }
                return null;
            }
            
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            // Group by month (ignoring year for overall pattern)
            const monthlyData = {};
            for (let m = 0; m < 12; m++) {
                monthlyData[m] = { open: [], click: [], count: 0 };
            }
            
            filteredData.forEach(item => {
                const month = getMonth(item.date);
                if (month !== null) {
                    monthlyData[month].open.push(item.open);
                    monthlyData[month].click.push(item.click);
                    monthlyData[month].count += 1;
                }
            });
            
            // Calculate averages
            const monthStats = [];
            let minScore = Infinity, maxScore = -Infinity;
            
            for (let m = 0; m < 12; m++) {
                if (monthlyData[m].count > 0) {
                    const avgOpen = monthlyData[m].open.reduce((a, b) => a + b, 0) / monthlyData[m].count;
                    const avgClick = monthlyData[m].click.reduce((a, b) => a + b, 0) / monthlyData[m].count;
                    const score = avgOpen; // Changed to use open rate only
                    
                    monthStats.push({
                        month: m,
                        avgOpen,
                        avgClick,
                        count: monthlyData[m].count,
                        score
                    });
                    
                    minScore = Math.min(minScore, score);
                    maxScore = Math.max(maxScore, score);
                } else {
                    monthStats.push({
                        month: m,
                        avgOpen: null,
                        avgClick: null,
                        count: 0,
                        score: null
                    });
                }
            }
            
            // Find best and worst
            let bestMonth = monthStats.filter(m => m.score !== null).sort((a, b) => b.score - a.score)[0];
            let worstMonth = monthStats.filter(m => m.score !== null).sort((a, b) => a.score - b.score)[0];
            
            if (!bestMonth) bestMonth = { month: 0, avgOpen: 0, avgClick: 0 };
            if (!worstMonth) worstMonth = { month: 0, avgOpen: 0, avgClick: 0 };
            
            // Get color
            function getColor(score) {
                if (score === null) return '#f7fafc';
                const normalized = (score - minScore) / (maxScore - minScore);
                const intensity = Math.round(normalized * 255);
                return `rgb(${66}, ${153 + intensity}, ${225})`;
            }
            
            // Build HTML
            let html = '';
            
            // Stats cards
            html += '<div class="heatmap-stats">';
            html += `
                <div class="heatmap-stat-card">
                    <div class="heatmap-stat-label">Best Month (Open Rate)</div>
                    <div class="heatmap-stat-value">${monthNames[bestMonth.month]}</div>
                    <div style="font-size: 0.75rem; color: #718096; margin-top: 4px;">
                        ${bestMonth.avgOpen.toFixed(1)}% open | ${bestMonth.avgClick.toFixed(1)}% click
                    </div>
                </div>
                <div class="heatmap-stat-card">
                    <div class="heatmap-stat-label">Campaigns Analyzed</div>
                    <div class="heatmap-stat-value">${filteredData.length}</div>
                </div>
                <div class="heatmap-stat-card">
                    <div class="heatmap-stat-label">Worst Month (Open Rate)</div>
                    <div class="heatmap-stat-value">${monthNames[worstMonth.month]}</div>
                    <div style="font-size: 0.75rem; color: #718096; margin-top: 4px;">
                        ${worstMonth.avgOpen.toFixed(1)}% open | ${worstMonth.avgClick.toFixed(1)}% click
                    </div>
                </div>
            `;
            html += '</div>';
            
            // Heatmap
            html += '<div style="display: grid; grid-template-columns: repeat(12, 1fr); gap: 8px; margin: 20px 0;">';
            
            monthStats.forEach(stat => {
                const color = getColor(stat.score);
                const textColor = stat.score && stat.score > (minScore + maxScore) / 2 ? '#ffffff' : '#2d3748';
                
                if (stat.count > 0) {
                    html += `
                        <div style="background-color: ${color}; color: ${textColor}; padding: 20px 10px; border-radius: 8px; text-align: center; cursor: pointer; transition: transform 0.2s;" 
                             onmouseover="this.style.transform='scale(1.05)'" 
                             onmouseout="this.style.transform='scale(1)'"
                             title="${monthNames[stat.month]}: ${stat.avgOpen.toFixed(1)}% open, ${stat.avgClick.toFixed(1)}% click (${stat.count} campaigns)">
                            <div style="font-weight: 700; font-size: 0.9rem; margin-bottom: 8px;">${monthNames[stat.month]}</div>
                            <div style="font-size: 1.2rem; font-weight: 700;">${stat.avgOpen.toFixed(0)}%</div>
                            <div style="font-size: 0.7rem; opacity: 0.8;">${stat.count} campaigns</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div style="background-color: #f7fafc; color: #cbd5e0; padding: 20px 10px; border-radius: 8px; text-align: center;">
                            <div style="font-weight: 700; font-size: 0.9rem; margin-bottom: 8px;">${monthNames[stat.month]}</div>
                            <div style="font-size: 1.2rem;">-</div>
                            <div style="font-size: 0.7rem;">No data</div>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            
            // Legend
            html += '<div style="display: flex; align-items: center; gap: 20px; padding: 15px; background: #f7fafc; border-radius: 6px; font-size: 0.875rem;">';
            html += '<div style="font-weight: 600;">Open Rate:</div>';
            html += '<div style="display: flex; align-items: center; gap: 8px;"><div style="width: 30px; height: 20px; background: #dbeafe; border-radius: 3px;"></div><span>Low</span></div>';
            html += '<div style="display: flex; align-items: center; gap: 8px;"><div style="width: 30px; height: 20px; background: #60a5fa; border-radius: 3px;"></div><span>Medium</span></div>';
            html += '<div style="display: flex; align-items: center; gap: 8px;"><div style="width: 30px; height: 20px; background: #2563eb; border-radius: 3px;"></div><span>High</span></div>';
            html += '<div style="margin-left: 20px; color: #718096;">Colors and rankings based on average open rate</div>';
            html += '</div>';
            
            container.innerHTML = html;
        }

        function updateCharts() {
            filterData();
            calculateStats();
            createLeadershipChart();
            createTPWChart();
            createCampaignTypeChart();
            createProgramComparisonChart();
            createFederalStateChart();
            createMonthlyHeatmap();
        }

        function resetFilters() {
            document.getElementById('programFilter').value = 'all';
            document.getElementById('campaignFilter').value = 'all';
            updateCharts();
        }

        updateCharts();
    </script>
</body>
</html>
